apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  labels:
    apps.tanzu.vmware.com/task: test
  name: sonar
  namespace: default
spec:
  params:
  - name: source-url
    value: $(params.source-url)
  - name: source-revision
    value: $(params.source-revision)
  steps:
  - image: harbor-repo.vmware.com/dockerhub-proxy-cache/library/gradle
    name: code-analysis
    resources: {}
    script: |-
      cd `mktemp -d`

      wget -qO- $(params.source-url) | tar xvz
      cd outer-loop-main
      chmod +x mvnw
      ./mvnw verify sonar:sonar -Dsonar.projectKey=$(params.sonar-project-key) -Dsonar.host.url=$(params.sonar-host-url) -Dsonar.login=$(params.sonar-login)